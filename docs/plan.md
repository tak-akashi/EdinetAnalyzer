### アプリケーション構成案

アプリケーションを大きく3つのコンポーネントに分けて構築します。

1.  **フロントエンド (UI層):**
    *   **役割:** ユーザーからの質問を受け付け、分析結果を分かりやすく表示します。
    *   **技術:** `Streamlit`
    *   **機能:**
        *   質問入力用のテキストボックス
        *   分析実行ボタン
        *   結果表示エリア（生成された回答、参照した書類へのリンクなど）
        *   処理中のステータス表示

2.  **バックエンド (ロジック層):**
    *   **役割:** ユーザーの質問を解釈し、必要な情報を取得・分析して回答を生成する、アプリケーションの中核部分です。
    *   **技術:** `Python`, `LangGraph`, `LangChain`
    *   **構成:** `LangGraph`を用いて、以下のような状態を持つエージェント（自律的な処理フロー）を構築します。
        *   **質問解釈:** ユーザーの質問から、検索すべき企業名、期間、必要な財務情報などを特定します。
        *   **ツール実行:** 質問内容に応じて、以下の自作ツールを呼び出します。
            *   **EDINET検索ツール:** EDINET APIを叩いて、関連する開示資料のリスト（書類管理番号 `docID` を含む）を取得します。
            *   **XBRL解析ツール:** 取得した書類のZIPファイルをダウンロード・展開し、`edinet-xbrl-parser`ライブラリを使ってXBRLファイルから財務データを抽出・整形します。
        *   **回答生成:** ツールから得られた情報を元に、`LLM`が最終的な回答を自然言語で生成します。

3.  **LLM (モデル層):**
    *   **役割:** 自然言語の解釈と生成を担当します。
    *   **技術:** `Ollama`, `GPT-4o`など
    *   **詳細:** `Ollama`を介してローカル環境でオープンソースLLMを動かすか、API経由で`GPT-4o`のような高性能なモデルを利用するかを選択可能にします。

この構成により、UI、ビジネスロジック、AIモデルが疎結合になり、各部分を独立して開発・改善しやすくなります。

### 実装計画

以下のステップで実装を進めます。

1.  **ステップ0: 環境構築**
    *   Pythonの仮想環境をセットアップします。
    *   `streamlit`, `langchain`, `langgraph`, `edinet-xbrl-parser`, `pandas`, `requests` 等のライブラリをインストールします。
    *   EDINET APIの利用登録を行い、APIキーを取得して環境変数に設定します。
    *   (オプション) `Ollama`をインストールし、利用したいLLM（例: `Llama3`）をダウンロードしておきます。

2.  **ステップ1: EDINET APIクライアントの実装**
    *   EDINET APIと通信するための基本的な関数（書類リスト取得、書類ダウンロード）を実装し、クラスとしてまとめます。

3.  **ステップ2: XBRL解析モジュールの実装**
    *   ダウンロードしたZIPファイルを解析し、`edinet-xbrl-parser`を使って主要な財務データ（売上、利益、資産など）を抽出して、Pandas DataFrameなどの扱いやすい形式で返す関数を作成します。

4.  **ステップ3: LangChainツールの作成**
    *   ステップ1と2で作成した機能を、LangChainの`Tool`としてラップします。これにより、LLMエージェントがこれらの機能を簡単に呼び出せるようになります。

5.  **ステップ4: LangGraphエージェントの構築**
    *   質問応答のロジックを`LangGraph`で組み立てます。質問に応じてツールを呼び出し、得られた情報から最終回答を生成するまでの一連のフローを定義します。

6.  **ステップ5: StreamlitによるUIの構築**
    *   ユーザーが質問を入力し、結果を閲覧するためのシンプルなWebインターフェースを作成します。ボタンクリックをトリガーに、バックエンドで構築したエージェントが実行されるように接続します。

7.  **ステップ6: 全体の統合とテスト**
    *   全てのコンポーネントを結合し、一連の動作を確認します。様々な質問を試し、エージェントの挙動や回答の精度を検証・改善します。
